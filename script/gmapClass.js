var gmap=function(b,a){var c,d,e,f;this.id=b;this.Data=a;this.Ens={};e=$(this.Data.wrapper);if(this.determine()&&e&&(this.Ens.host=e,c=mk(),d={},a.address||(this.Data.address=e.select("address a").length?trim(e.select("address a")[0].innerHTML.stripTags()):this.defaultAddress),this.Data.address)){e.Data={ClassID:this.id};e.id||(e.id="gmap-"+this.id+getRand(1,1E4));c=this.template.cloneNode(!0);this.wc.ShadowDOM?(d.root=e[this.wc.ShadowDOM](),d.root.innerHTML="<style>"+this.cssStr+"</style>",this.Ens.sheet=
d.root.querySelector("style"),d.root.appendChild(c),d.canvas=d.root.querySelector(".map-canvas")):(empty(e),e.appendChild(mk("",{tag:"h3",att:{innerHTML:"google map"}})),e.appendChild(c),d.canvas=e.select(".map-canvas")[0]);this.Ens.canvas=$(d.canvas);f=this;this.Data.geocoder=new google.maps.Geocoder;this.Data.geocoder.geocode({address:this.Data.address},function(a,b){f.prepareStage(a,b)});for(var g in d)d[g]=null;d=null}};
gmap.prototype={defaultAddress:"\u53f0\u5317\u706b\u8eca\u7ad9",dependencies:["Prototype","HO","google.maps.Geocoder"],determine:function(){if("undefined"==typeof gmap.prototype.isSupport){var b=[],a={};gmap.prototype.wc=supportsWebComponents();gmap.prototype.isSupport=!0;createCSSClass("google-map","position:relative;width:100%;height:100%;display:block;user-select:none;-webkit-user-select:none;border-radius:10px;");createCSSClass("google-map h3","display:none");this.wc.ShadowDOM?(b.push({k:"h3",
v:"display:none;"}),b.push({k:".map-canvas",v:"width:100%;height:100%;"})):b.push({k:"google-map .map-canvas",v:"width:100%;height:100%;"});a.buffer=mk();gmap.prototype.template=a.buffer;a.mapCanvas=mk("map-canvas");a.buffer.appendChild(a.mapCanvas);Event.observe(window,"resize",this.resize);if(this.wc.ShadowDOM){for(a.cssStr="h3,div,figure{display:block;margin:0;padding:0;}img{border:0}a{text-decoration:none}a:hover{text-decoration:underline;}";b.length;){var c=b.shift();a.cssStr+=c.k+"{"+c.v+"}"}gmap.prototype.cssStr=
a.cssStr}else for(;b.length;)c=b.shift(),createCSSClass(c.k,c.v);for(var d in a)a[d]=null;this.activeCustomElement()}return gmap.prototype.isSupport},activeCustomElement:function(){if(!gmap.prototype.activeCE){var b=["","webkit","moz","o","ms"],a="",c;gmap.prototype.activeCE=!0;c=-1;for(var d=b.length;++c<d;){var e=b[c],f="registerElement",f=e.length?"registerElement".replace(/^[a-z]{1}/,function(a){return a.toLocaleUpperCase()}):"registerElement",e=e+f;if(document[e]){a=e;break}}"undefined"==typeof Ogmap&&
(Ogmap={});if(a)c=Object.create(HTMLElement.prototype),c.attachedCallback=function(){var a,b,c;this.mid=a="M"+getRand(1,1E4)+"-"+getRand(1,1E4);b={wrapper:this};if(this.hasAttribute("data-conf")){try{c=JSON.parse(this.getAttribute("data-conf"))}catch(e){c={}}for(var d in c)b[d]=c[d],c[d]=null;this.removeAttribute("data-conf")}Ogmap["gmap"+a]=new gmap(a,b)},c.detachedCallback=function(){"undefined"!=typeof this.mid&&Ogmap["gmap"+this.mid].terminate()},c.attributeChangedCallback=gmap.prototype.attrChange,
c.reLocate=gmap.prototype.reLocateG,document[a]("google-map",{prototype:c});else for(a=$$("google-map"),c=-1,d=a.length;++c<d;){var e=a[c],g,f="M"+getRand(1,1E4)+"-"+getRand(1,1E4),b={wrapper:e};if(e.hasAttribute("data-conf")){try{g=JSON.parse(e.getAttribute("data-conf"))}catch(k){g={}}for(var h in g)b[h]=g[h],g[h]=null;g=null;e.removeAttribute("data-conf")}Ogmap["gmap"+f]=new gmap(f,b)}}},terminate:function(){var b=this.id;this.Ens.host.reLocate=null;setTimeout(function(){var a=Ogmap["gmap"+b];purge(a.Data);
for(var c in a.Ens)a.Ens[c]=null;a.id=a.Data=a.Ens=null;try{delete Ogmap["gmap"+b]}catch(d){}},100)},attrChange:function(b,a,c){"data-address"==b&&(b=getIns(this,"gmap"))&&b.geocode(c)},geocode:function(b){var a;this.Data.address!=b&&(a=this,this.Data.geocoder.geocode({address:b},function(c,d){d==google.maps.GeocoderStatus.OK&&(a.Data.address=b,a.Data.center=c[0].geometry.location,a.reLocate())}))},reLocateG:function(b){var a=getIns(this,"gmap");a&&"string"==typeof b&&a.geocode(b)},reLocate:function(){this.Ens.marker.setPosition(this.Data.center);
this.refresh()},resize:function(){for(var b in Ogmap){var a=Ogmap[b];a.Ens.host.hasClassName("active")&&a.refresh()}},zoomChange:function(){this.refresh()},refresh:function(){google.maps.event.trigger(this.Ens.map,"resize");this.Ens.map.panTo(this.Data.center)},prepareStage:function(b,a){var c;c=this;this.Data.center=a==google.maps.GeocoderStatus.OK?b[0].geometry.location:new google.maps.LatLng(0,0);this.Ens.map=new google.maps.Map(this.Ens.canvas,{zoom:16,center:this.Data.center});this.Ens.marker=
new google.maps.Marker({map:this.Ens.map,animation:google.maps.Animation.DROP,position:this.Data.center});this.Ens.map.addListener("zoom_changed",function(){c.zoomChange()});"function"!=typeof this.Ens.host.reLocate&&(this.Ens.host.reLocate=gmap.prototype.reLocateG);setTimeout(function(){c.refresh()},100);this.Ens.host.removeAttribute("hidden");this.Ens.host.addClassName("active")}};
(function(){var b,a=0;"undefined"==typeof navigator.oRegists&&(navigator.oRegists={});b=gmap.prototype.dependencies;navigator.oRegists.gmap=setInterval(function(){var c=!0;a+=5;if(1E4<=a)clearInterval(navigator.oRegists.gmap);else{for(var d=-1,e=b.length;++d<e;){for(var f=window,g=b[d].split(".");g.length;){var h=g.shift();if(f[h])f=f[h];else{f=null;break}}c&=null!=f}c&&document.body&&(clearInterval(navigator.oRegists.gmap),navigator.oRegists.gmap=null,gmap.prototype.determine())}},5)})();/*programed by mei(李維翰), http://www.facebook.com/mei.studio.li*/